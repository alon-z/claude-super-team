---
phase: 08-full-auto-mode
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - plugins/claude-super-team/skills/build/references/autonomous-decision-guide.md
  - plugins/claude-super-team/skills/build/references/pipeline-guide.md
autonomous: true

must_haves:
  truths:
    - "autonomous-decision-guide.md covers the decision framework for all AskUserQuestion calls"
    - "autonomous-decision-guide.md lists special cases for known skill questions"
    - "pipeline-guide.md defines adaptive pipeline depth heuristic with complexity/simplicity signals"
    - "pipeline-guide.md defines adaptive validation heuristic with validate/skip conditions"
    - "pipeline-guide.md defines file path detection heuristic"
    - "pipeline-guide.md documents the git branch flow (plan on main, execute on feature branch, squash-merge)"
  artifacts:
    - path: "plugins/claude-super-team/skills/build/references/autonomous-decision-guide.md"
      provides: "Heuristics for autonomous AskUserQuestion answers"
    - path: "plugins/claude-super-team/skills/build/references/pipeline-guide.md"
      provides: "Pipeline depth, validation, input detection, and git workflow heuristics"
  key_links:
    - from: "plugins/claude-super-team/skills/build/references/autonomous-decision-guide.md"
      to: "SKILL.md (plan 03)"
      via: "Read tool reference in SKILL.md autonomous decision sections"
    - from: "plugins/claude-super-team/skills/build/references/pipeline-guide.md"
      to: "SKILL.md (plan 03)"
      via: "Read tool reference in SKILL.md pipeline orchestration sections"
---

<objective>
Create the /build skill's two reference guides: the autonomous decision guide (how to answer AskUserQuestion calls without user input) and the pipeline guide (heuristics for adaptive pipeline depth, validation, input detection, and git workflow).

Purpose: These reference files are embedded into the SKILL.md via Read tool references. They contain the detailed heuristics that would bloat the SKILL.md if inlined. Externalizing them also allows independent updates without modifying the core skill logic.

Output: 2 reference files in `plugins/claude-super-team/skills/build/references/`.
</objective>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-full-auto-mode/08-CONTEXT.md
@.planning/phases/08-full-auto-mode/08-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create autonomous-decision-guide.md</name>
  <files>plugins/claude-super-team/skills/build/references/autonomous-decision-guide.md</files>
  <action>
Create `plugins/claude-super-team/skills/build/references/autonomous-decision-guide.md`. This is the reference guide that /build reads (via Read tool) when it needs to autonomously answer AskUserQuestion calls from child skills.

The guide must contain:

**1. Core Decision Framework**

Adapt the "Autonomous Decision Guide Core Pattern" from RESEARCH.md into a clear, step-by-step framework:

1. READ the AskUserQuestion: header, question text, all option labels and descriptions
2. CHECK build-preferences.md for a directly relevant preference (tech stack, exec model, architecture, etc.)
3. If preference found: SELECT that option, log decision with HIGH confidence
4. If no preference: REASON about the best option using:
   - Project context (what is being built, current phase goal)
   - Prior decisions (BUILD-STATE.md decisions log -- consistency matters)
   - Software engineering best practices
   - The principle of moving forward (never abort/cancel)
5. SELECT using these priorities (in order):
   a. Preference match (from build-preferences.md)
   b. Option that moves pipeline forward (never "Abort", "Cancel", "Stop", "Exit")
   c. Recommended/default option (often first option, or one marked "Recommended")
   d. Option that accepts reasonable defaults over custom configuration
   e. Option that favors completeness and quality over speed
6. LOG the decision to BUILD-STATE.md Decisions Log with: phase, skill, question summary, answer, confidence (high/medium/low)
7. NEVER present the question to the user -- always select and continue

**2. Confidence Levels**

- **high**: Preference match, or clear best option with strong reasoning
- **medium**: Reasonable choice but alternatives were viable
- **low**: Genuinely ambiguous, picked best guess -- flag for user review

**3. Special Cases by Skill**

Map known AskUserQuestion patterns to their autonomous answers. Group by skill:

**/new-project:**
- "Existing project detected" -> If BUILD-STATE.md shows greenfield intent, this is unexpected; log and continue. If brownfield, acknowledge.
- "Brownfield detection: Map codebase first?" -> "Skip mapping" (locked decision says always map brownfield, but /new-project exits if you pick "Map first" without creating PROJECT.md -- /build handles /map-codebase independently in Step 6)
- "Keep exploring / More questions" -> "Create PROJECT.md" / "All set" (move forward after reasonable exploration, do not loop endlessly)
- "Exec model preference" -> Use build-preferences.md exec model, or default to opus

**/brainstorm:**
- "Mode" -> "Autonomous" (locked decision)
- "Review ideas" -> "Approve all" (move forward)
- "Update roadmap?" -> "Add to roadmap" (ideas should flow into roadmap)

**/create-roadmap:**
- "Phase count / structure" -> Accept LLM recommendation (the roadmap skill reasons about this well)
- "Confirm roadmap" -> Accept / approve

**/discuss-phase:**
- Gray area questions -> Answer based on project context, tech stack preferences, and common patterns. Log medium confidence for domain-specific decisions.
- "Continue discussing / All set" -> "All set" after answering all presented gray areas (do not request more questions)

**/research-phase:**
- "Continue research / Done" -> "Done" (research was autonomous, accept results)
- "RESEARCH.md already exists" -> "Replace entirely" (fresh run, BUILD-STATE tracks no prior research)
- "Research was blocked" -> "Plan without research" (skip and continue, consistent with locked decision)
- "Research conflicts with discuss-phase decisions" -> "Keep decisions" (CONTEXT.md locked decisions always take precedence)

**/plan-phase:**
- "Plan revision needed" -> "Accept plans" unless the checker found critical issues, then "Revise" (one revision max)
- "Verify plans" -> Always verify

**/execute-phase:**
- "Branch warning: on main" -> "Continue anyway" (/build manages its own branches -- it will be on a build/ branch or intentionally on main for planning)
- "Exec model" -> Use build-preferences.md preference, or use STATE.md preference
- "Task blocked" -> "Skip task" (cannot provide human guidance autonomously)
- "Checkpoint: human-verify" -> AUTO-APPROVE, log as low confidence
- "Checkpoint: decision" -> Use LLM reasoning, log decision
- "Verification gaps found" -> "Accept as-is" (do NOT trigger execute-phase's internal gap closure -- rely on the external build/test validation in Step 9h, and /phase-feedback in Step 9i for the single permitted feedback attempt)

**/phase-feedback:**
- "Which phase?" -> Current phase (from BUILD-STATE.md)
- "Feedback scope" -> "Standard feedback" (plan + execute path for verification failures)
- "Research needed?" -> Follow adaptive pipeline depth heuristic

**/map-codebase:**
- "Mode" -> "Full map" (first run) or "Refresh" (if codebase already mapped)

**4. Fallback Rules**

When no special case matches:
- If options include "Continue" or "Proceed": select it
- If options include "Accept" or "Approve": select it
- If options include a "Recommended" label: select it
- If options are feature choices (which library, which pattern): reason from project context and preferences
- If truly stuck: pick the first option, log as low confidence
- NEVER select "Abort", "Cancel", "Stop", "Exit" unless the question is about whether to abort a specific failing sub-task (in which case, "Skip" is preferred)

**5. Post-Compaction Reminder**

After context compaction, this guide may not be in context. The SKILL.md includes a compaction re-injection instruction that re-reads this file. The core principle to always remember: NEVER present AskUserQuestion to the user. Always answer autonomously.
  </action>
  <verify>
Verify the file exists and contains all 5 major sections:
```bash
test -f plugins/claude-super-team/skills/build/references/autonomous-decision-guide.md && echo "File exists"
grep -c "^#" plugins/claude-super-team/skills/build/references/autonomous-decision-guide.md
```
Confirm it covers: Core Decision Framework, Confidence Levels, Special Cases by Skill (with at least 8 skills listed), Fallback Rules, Post-Compaction Reminder.
  </verify>
  <done>autonomous-decision-guide.md exists with complete decision framework, confidence level definitions, per-skill special cases covering all 14 skills that have AskUserQuestion calls, fallback rules, and compaction resilience note.</done>
</task>

<task type="auto">
  <name>Task 2: Create pipeline-guide.md</name>
  <files>plugins/claude-super-team/skills/build/references/pipeline-guide.md</files>
  <action>
Create `plugins/claude-super-team/skills/build/references/pipeline-guide.md`. This contains the heuristics and workflows that /build's SKILL.md references for pipeline orchestration decisions.

The guide must contain:

**1. Skill Invocation Order**

Document the complete pipeline from RESEARCH.md "Skill Invocation Order" section:

```
1. Input detection: parse $ARGUMENTS for file paths vs inline text
2. Invoke /new-project with idea/PRD content
3. [If brownfield: CODE_FILES > 0] Invoke /map-codebase
4. Invoke /brainstorm (autonomous mode)
5. Invoke /create-roadmap
6. For each phase N in ROADMAP.md:
   a. Evaluate adaptive pipeline depth
   b. [If full pipeline] Invoke /discuss-phase N
   c. [If full pipeline] Invoke /research-phase N
   d. Invoke /plan-phase N
   e. Git: commit planning on main, create feature branch
   f. Invoke /execute-phase N
   g. Git: commit execution results on feature branch
   h. [If adaptive validation says yes] Validate (build + test)
   i. [If validation fails] /phase-feedback N (one attempt)
   j. [If still fails] Mark incomplete, continue
   k. Git: squash-merge to main, delete feature branch
   l. Update BUILD-STATE.md
7. Final validation (always)
8. [If fails] Auto-fix loop (max 3 attempts)
9. Generate BUILD-REPORT.md
10. Present completion summary
```

**2. Adaptive Pipeline Depth Heuristic**

Adapt from RESEARCH.md "Adaptive Pipeline Depth Heuristic":

COMPLEXITY SIGNALS (run full pipeline: discuss -> research -> plan -> execute):
- Goal mentions a new technical domain: auth, payments, search, real-time, file uploads, email, notifications, deployment, CI/CD, monitoring
- Goal mentions integration with external services or APIs
- Success criteria reference security, compliance, or data protection
- The phase has 4+ success criteria
- Prior phase artifacts do not cover this domain
- build-preferences.md does NOT specify tech decisions for this domain

SIMPLICITY SIGNALS (skip discuss/research: plan -> execute directly):
- Goal mentions: setup, init, config, scaffold, boilerplate, structure, foundation
- Goal mentions: update, tweak, adjust, rename, move, refactor, cleanup
- Goal extends patterns already established in earlier phases
- The phase has 1-2 success criteria
- build-preferences.md already specifies the tech decisions for this domain

DEFAULT: If signals are mixed or unclear, run the full pipeline. Discuss and research are cheap relative to building the wrong thing.

CONSTRAINTS:
- /brainstorm always runs (before /create-roadmap, not per-phase)
- /map-codebase always runs for brownfield (CODE_FILES > 0)
- Only /discuss-phase and /research-phase are skippable per-phase

**3. Adaptive Validation Heuristic**

Adapt from RESEARCH.md "Adaptive Validation Heuristic":

VALIDATE (run build + tests after phase execution):
- Phase created or modified source code files (*.ts, *.js, *.py, *.go, *.rs, etc.)
- Phase created or modified package files (package.json, requirements.txt, Cargo.toml, go.mod)
- Phase created or modified test files (*.test.*, *.spec.*, test_*.py)
- Phase goal mentions: build, implement, create, code, develop
- A build system exists (package.json with "build" or "test" scripts, Makefile, Cargo.toml)
- It is the FINAL phase (always validate regardless of content)

SKIP VALIDATION:
- Phase only created/modified .planning/ files
- Phase only created/modified documentation (*.md outside of code)
- Phase only created/modified config files with no source code changes
- No build system exists yet (too early in the pipeline)

VALIDATION COMMAND DETECTION (in priority order):
1. `package.json` -> check "scripts" for: build, test, lint. Run: `npm run build`, `npm test`
2. `Makefile` / `makefile` -> check for: build, test targets. Run: `make build`, `make test`
3. `Cargo.toml` -> Run: `cargo build`, `cargo test`
4. `go.mod` -> Run: `go build ./...`, `go test ./...`
5. `requirements.txt` / `setup.py` / `pyproject.toml` -> Run: `pytest` (if test files exist)
6. `bun.lockb` -> Run: `bun run build`, `bun test`
7. If none detected: skip build, attempt to find any test runner

**4. File Path Detection Heuristic**

Adapt from RESEARCH.md "File Path Detection Heuristic":

To parse $ARGUMENTS into file path(s) and/or inline idea text:

1. Split $ARGUMENTS on whitespace
2. For each token, check if it is a potential file path:
   - Starts with `/`, `./`, `~/`, or `../` -> potential path
   - Ends with `.md`, `.txt`, `.doc`, `.pdf`, `.rtf` -> potential path
   - Contains `/` and does not start with `http` -> potential path
3. For each potential path, verify it exists and is readable: `test -f "$token"`
4. Results:
   - If confirmed file path(s) found: read file contents as PRD/vision document. Remaining non-path tokens are additional context.
   - If no confirmed file path: entire $ARGUMENTS string is the project idea
   - If both file path and remaining text: pass both to /new-project (file as PRD, text as supplementary)

**5. Git Branch Flow**

Adapt from RESEARCH.md "Git Branch Flow":

```
For each phase execution:

PLANNING PHASE (on main):
  # Commit discuss/research/plan artifacts
  git add .planning/phases/{NN}-{slug}/ .planning/STATE.md
  git commit -m "[build] Plan phase {N}: {name}"

BRANCH CREATION (before execute):
  git checkout -b build/{NN}-{slug}

EXECUTION (on feature branch):
  # /execute-phase runs here
  # After completion, commit all changes
  git add -A
  git commit -m "[build] Execute phase {N}: {name}"

SQUASH-MERGE (after execution + validation):
  git checkout main
  git merge --squash build/{NN}-{slug}
  git commit -m "[build] Phase {N}: {phase_name}

  {1-2 sentence summary of what was built}

  Validation: {pass|fail|skipped}
  Plans executed: {M}/{total}

  Autonomous build by /build skill."
  git branch -d build/{NN}-{slug}

RESUME HANDLING:
  If /build resumes and finds a build/* branch:
  1. Check if execution completed (SUMMARY.md files exist for all plans)
  2. If yes: squash-merge to main and continue to next phase
  3. If no: checkout the branch and resume execution from incomplete plan
  If /build resumes on main with no build/* branches:
  - Resume from BUILD-STATE.md current stage (re-run the in_progress stage)
```

**6. Final Validation and Auto-Fix**

Document the final validation flow:

After all phases complete:
1. Always run build + test validation (regardless of adaptive heuristic)
2. Detect validation commands (section 3 priority order)
3. If build/tests pass: proceed to BUILD-REPORT.md
4. If build/tests fail: enter auto-fix loop:
   a. Read error output
   b. Analyze errors and determine fixes
   c. Apply fixes using Edit/Write tools
   d. Re-run build/tests
   e. If pass: done
   f. If fail and attempts < 3: repeat from (a)
   g. If fail and attempts >= 3: log errors, mark build as partial, proceed to report
5. Each attempt is logged in BUILD-STATE.md Errors section

**7. Phase Feedback Flow**

Document how /build invokes /phase-feedback after validation failure:

1. Synthesize feedback description from validation errors (build output, test failures)
2. Invoke: `/phase-feedback {N} {synthesized_feedback_description}`
3. /phase-feedback creates a subphase (e.g., 2.1-feedback-fix) with a plan
4. /build then invokes `/execute-phase {N.1}` to execute the fix plan
5. After feedback execution, re-run validation
6. If still fails: mark phase as incomplete in BUILD-STATE.md, continue to next phase
7. Only ONE feedback attempt per phase (locked decision)
  </action>
  <verify>
Verify the file exists and contains all 7 sections:
```bash
test -f plugins/claude-super-team/skills/build/references/pipeline-guide.md && echo "File exists"
grep -c "^##" plugins/claude-super-team/skills/build/references/pipeline-guide.md
```
Confirm it covers: Skill Invocation Order, Adaptive Pipeline Depth, Adaptive Validation, File Path Detection, Git Branch Flow, Final Validation and Auto-Fix, Phase Feedback Flow.
  </verify>
  <done>pipeline-guide.md exists with 7 sections covering the complete pipeline orchestration logic. All heuristics from RESEARCH.md are adapted and expanded. Git flow, validation, and feedback patterns are fully documented.</done>
</task>

</tasks>

<verification>
1. Both reference files exist in `plugins/claude-super-team/skills/build/references/`
2. autonomous-decision-guide.md has the 5-section structure with per-skill special cases
3. pipeline-guide.md has the 7-section structure with all heuristics
4. No overlap or contradiction between the two guides
5. All locked decisions from CONTEXT.md are reflected (adaptive depth, always brainstorm, always map brownfield, one feedback attempt, skip and continue, etc.)
6. No deferred ideas appear (no parallel phases, no remote git, no target directory, no build profiles)
</verification>

<success_criteria>
Both reference guides are complete and self-contained. An executor building the SKILL.md (Plan 03) can reference these guides via Read tool and have access to all heuristics, decision frameworks, and workflow documentation needed for the /build skill's orchestration logic.
</success_criteria>

<output>
After completion, create `.planning/phases/08-full-auto-mode/08-02-SUMMARY.md`
</output>
