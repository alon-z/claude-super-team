# Context for Phase 1.2: Execute-phase branch guard and team capability logging

## Phase Boundary (from ROADMAP.md)

**Goal:** Add a main-branch guard to prevent accidental execution on main, and require explicit logging of why team mode is or isn't used for each execution

**Success Criteria:**
1. Execute-phase refuses to run when on the main branch, prompting the user to switch branches
2. Execute-phase always prints a reason for its team/task execution mode decision

**What's in scope for this phase:**
- Branch check logic in execute-phase SKILL.md
- Team mode decision logging in execute-phase SKILL.md

**What's explicitly out of scope:**
- Changes to other skills
- Changes to team mode behavior itself

---

## Implementation Decisions

### Branch Guard Behavior

**Decision:** Warn and confirm -- when on main branch, show a warning via AskUserQuestion and let the user override if they choose.

**Rationale:** Hard-blocking is too rigid for a personal tool. Sometimes executing on main is intentional (e.g., quick phases, small fixes). The warning ensures awareness without preventing legitimate use.

**Constraints:** Must use AskUserQuestion with clear options (e.g., "Switch branch" vs "Continue anyway").

### Detached HEAD / Missing Git

**Decision:** Warn but allow -- if git is not available or HEAD is detached, print a note but continue execution.

**Rationale:** The branch guard is specifically about protecting main. Missing git or detached HEAD are edge cases that shouldn't block execution.

**Constraints:** The warning should be a simple printed note, not an AskUserQuestion prompt.

### Team Mode Decision Logging

**Decision:** Log the team mode decision with an explanatory tone that includes how to change the setting.

**Rationale:** Users need to understand why team mode is or isn't active, and how to toggle it. A dry factual message doesn't help users who want to switch modes.

**Constraints:** Message format examples:
- "Using task mode -- teams not enabled. Pass --team or set CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS=1 to use teams."
- "Using teams mode (--team flag)."
- "Using task mode -- single plan in wave, teams not beneficial."

---

## Claude's Discretion

- When to log the team decision (once at start vs per-wave) -- Claude decides based on what makes most sense for the skill flow.

---

## Deferred Ideas

None.
