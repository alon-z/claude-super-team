---
phase: 01.6-progress-sync-detection
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - plugins/claude-super-team/skills/progress/SKILL.md
  - plugins/claude-super-team/skills/cst-help/SKILL.md
  - plugins/claude-super-team/skills/cst-help/references/troubleshooting.md
  - plugins/claude-super-team/skills/cst-help/references/workflow-guide.md
autonomous: true
quick_phase: true

must_haves:
  truths:
    - "/progress includes a sync detection step that runs before the status report and detects directory-vs-roadmap mismatches, STATE.md drift, and progress table inconsistencies"
    - "/progress outputs a prominent warning block at the top of the report (before the phase table) when sync issues are found, and omits it entirely when no issues exist"
  artifacts:
    - plugins/claude-super-team/skills/progress/SKILL.md (updated with sync detection phase)
    - plugins/claude-super-team/skills/cst-help/SKILL.md (updated skill reference)
    - plugins/claude-super-team/skills/cst-help/references/troubleshooting.md (sync detection troubleshooting)
    - plugins/claude-super-team/skills/cst-help/references/workflow-guide.md (updated progress description)
  key_links: []
---

<objective>
Add planning file sync detection to the /progress skill so it detects and reports mismatches between phase directories, ROADMAP.md entries, STATE.md references, and progress table entries. Update cst-help skill and references to document the new capability.

Purpose: The progress skill currently trusts that planning files are in sync, but manual edits, interrupted skills, or quick-plan insertions can cause drift. Detecting this early prevents confusing routing and status reports.
Output: Updated SKILL.md for progress (with new sync detection phase), updated cst-help SKILL.md, troubleshooting.md, and workflow-guide.md.
</objective>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01.6-progress-sync-detection/01.6-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add sync detection phase to progress SKILL.md</name>
  <files>plugins/claude-super-team/skills/progress/SKILL.md</files>
  <action>
Insert a new "Phase 1.5: Detect Planning File Sync Issues" between the existing Phase 1 (Verify Planning Structure) and Phase 2 (Load Context). This new phase runs only when the project has an active planning structure (PROJECT.md + ROADMAP.md + STATE.md all exist). It performs three checks using Bash/Grep:

1. **Directory vs Roadmap**: List all phase directories in `.planning/phases/` and extract their phase numbers. Parse all phases from ROADMAP.md (both the "## Phases" checklist and "## Phase Details" sections). Report directories without a matching ROADMAP.md entry ("orphan directories") and ROADMAP.md phases without a matching directory ("missing directories").

2. **STATE.md drift**: Extract the current phase number from STATE.md. Check that it matches a phase listed in ROADMAP.md and has a corresponding directory. Report if either is missing.

3. **Progress table inconsistencies**: Parse phase entries from the ROADMAP.md "## Progress" table and from the "## Phases" checklist. Report entries in the Progress table that have no matching Phases checklist entry, and Phases checklist entries missing from the Progress table.

If any issues are found, collect them into a warning block. In Phase 6 (Present Status Report), insert this warning block immediately after the progress bar/phase line and before the "---" separator that precedes the Phases table. Use this format:

```
### Sync Issues

- Directory `02.1-security-hardening` has no matching entry in ROADMAP.md
- ROADMAP.md Phase 3 has no matching directory
- STATE.md references Phase 7 which is not in ROADMAP.md
- Progress table lists "Phase 3" but it is not in the Phases checklist
```

If no issues are found, omit the "### Sync Issues" section entirely. Renumber subsequent phases in the Process section (Phase 2 becomes Phase 3, etc.) to accommodate the new phase. Update the Success Criteria checklist to include sync detection.
  </action>
  <verify>Read the updated SKILL.md and confirm: (1) a sync detection phase exists between structure verification and context loading, (2) it checks all three categories (directory vs roadmap, STATE.md drift, progress table), (3) output format uses "### Sync Issues" block positioned before the phase table, (4) the section is omitted when no issues found, (5) subsequent phase numbers are consistent.</verify>
  <done>The progress SKILL.md contains a sync detection phase that performs all three checks and outputs a warning block at the top of the report when issues exist.</done>
</task>

<task type="auto">
  <name>Task 2: Update cst-help skill reference and documentation</name>
  <files>
plugins/claude-super-team/skills/cst-help/SKILL.md
plugins/claude-super-team/skills/cst-help/references/troubleshooting.md
plugins/claude-super-team/skills/cst-help/references/workflow-guide.md
  </files>
  <action>
Update three cst-help files to document the new sync detection capability:

**SKILL.md** -- In the "Help Response: Skill Reference" section, update the `/progress` entry to mention sync detection. Change:
```
/progress
  Check status and get smart routing
  -> Shows current position, recent work, next action
  -> Steps column (D/R/P) shows discuss, research, plan status per phase
```
To add a line about sync detection:
```
/progress
  Check status and get smart routing
  -> Detects sync issues between phase directories, ROADMAP.md, STATE.md, and progress table
  -> Shows current position, recent work, next action
  -> Steps column (D/R/P) shows discuss, research, plan status per phase
```

**troubleshooting.md** -- Add a new entry under the "### Progress and Routing" section:

```
#### "/progress shows sync issues"

**Symptom:** Progress report shows a "Sync Issues" warning block at the top

**Cause:** Planning files are out of sync -- directories don't match ROADMAP.md, STATE.md points to nonexistent phase, or progress table is inconsistent with phases checklist

**Solution:**
- Read the specific warnings to identify which files are out of sync
- For orphan directories: add the phase to ROADMAP.md or delete the directory
- For missing directories: create the directory or remove the phase from ROADMAP.md
- For STATE.md drift: update STATE.md to reference a valid phase
- For progress table issues: add missing entries or remove extra ones from the Progress table in ROADMAP.md
- Run `/progress` again to verify sync issues are resolved
```

Also update the "### Use `/progress` when:" section to add: "- Planning files might be out of sync (after manual edits or interrupted skills)"

**workflow-guide.md** -- In "The Sequential Pipeline" section, update the `/progress` line to mention sync detection. Also in the "### When Lost or Returning" pattern, add a note about sync detection. In the "### State Tracking" section under Key Concepts, add a bullet about sync detection by `/progress`.
  </action>
  <verify>Read each updated file and confirm: (1) cst-help SKILL.md mentions sync detection in the /progress skill reference entry, (2) troubleshooting.md has a new entry for sync issues under Progress and Routing, (3) workflow-guide.md mentions sync detection in the pipeline overview and state tracking sections.</verify>
  <done>All three cst-help reference files document the sync detection capability: skill reference updated, troubleshooting entry added, workflow guide updated.</done>
</task>

</tasks>

<verification>
Read the progress SKILL.md end-to-end to confirm:
1. Sync detection phase exists and checks all three categories
2. Warning block is positioned before the phase table
3. Warning section is omitted when no issues found
4. Phase numbering in the Process section is consistent

Read cst-help SKILL.md, troubleshooting.md, and workflow-guide.md to confirm sync detection is documented consistently across all three.
</verification>

<success_criteria>
1. `/progress` includes a "Sync Issues" section that detects phase directories not listed in ROADMAP.md and ROADMAP.md phases without matching directories
2. `/progress` reports when STATE.md references a phase that doesn't exist in ROADMAP.md or has no directory
3. `/progress` detects progress table entries that don't match the phases checklist
4. Warning block appears only when issues are found, positioned before the phase table
5. cst-help skill and references are updated with sync detection documentation
</success_criteria>

<output>
After completion, create `.planning/phases/01.6-progress-sync-detection/01.6-01-SUMMARY.md`
</output>
