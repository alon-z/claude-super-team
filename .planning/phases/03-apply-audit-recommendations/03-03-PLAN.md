---
phase: 03-apply-audit-recommendations
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - plugins/marketplace-utils/skills/marketplace-manager/SKILL.md
  - plugins/task-management/skills/linear-sync/SKILL.md
  - plugins/task-management/skills/github-issue-manager/SKILL.md
  - plugins/claude-super-team/agents/phase-researcher.md
autonomous: true

must_haves:
  truths:
    - "marketplace-manager has a complete allowed-tools list with specific Bash patterns (no longer unrestricted)"
    - "marketplace-manager has an argument-hint for subcommand routing"
    - "linear-sync has Skill in allowed-tools so it can delegate to linear-cli"
    - "github-issue-manager uses haiku model instead of sonnet"
    - "github-issue-manager has an argument-hint for subcommand routing"
    - "phase-researcher agent has maxTurns safety limit and memory: project for cross-session learning"
  artifacts:
    - path: "plugins/marketplace-utils/skills/marketplace-manager/SKILL.md"
      provides: "Complete allowed-tools with specific Bash patterns + argument-hint"
    - path: "plugins/task-management/skills/linear-sync/SKILL.md"
      provides: "Skill tool in allowed-tools for linear-cli delegation"
    - path: "plugins/task-management/skills/github-issue-manager/SKILL.md"
      provides: "haiku model + argument-hint for subcommands"
    - path: "plugins/claude-super-team/agents/phase-researcher.md"
      provides: "maxTurns: 40 safety limit + memory: project"
  key_links:
    - from: "02-AUDIT.md priority #1 (marketplace-manager)"
      to: "marketplace-manager/SKILL.md allowed-tools"
      via: "First ever allowed-tools definition for this skill"
    - from: "02-AUDIT.md priority #2 (linear-sync missing Skill)"
      to: "linear-sync/SKILL.md allowed-tools"
      via: "Adding Skill tool to fix functional bug"
---

<objective>
Fix cross-plugin skills (marketplace-manager, linear-sync, github-issue-manager) and the phase-researcher agent.

Purpose: Close the two most critical audit gaps (marketplace-manager missing allowed-tools, linear-sync missing Skill tool), apply model/argument-hint fixes to github-issue-manager, and add safety limits to the phase-researcher agent.
Output: 3 updated SKILL.md files across 2 plugins + 1 updated agent definition.
</objective>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-skill-audit-and-reclassification/02-AUDIT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix marketplace-manager, linear-sync, and github-issue-manager</name>
  <files>
    plugins/marketplace-utils/skills/marketplace-manager/SKILL.md
    plugins/task-management/skills/linear-sync/SKILL.md
    plugins/task-management/skills/github-issue-manager/SKILL.md
  </files>
  <action>
**marketplace-manager/SKILL.md** -- This is the highest priority fix in the entire audit. The skill currently has NO allowed-tools, giving it unrestricted access to all tools.

Edit the YAML frontmatter. The current frontmatter is:
```yaml
---
name: marketplace-manager
model: haiku
description: Manage and fix Claude Code plugin marketplaces -- audit for issues, register/remove/create plugins, update entries, sync versions, configure distribution, and maintain marketplace.json manifests. Use when working with marketplace catalogs, plugin entries, team distribution settings, or fixing marketplace inconsistencies.
---
```

Replace it with:
```yaml
---
name: marketplace-manager
model: haiku
description: Manage and fix Claude Code plugin marketplaces -- audit for issues, register/remove/create plugins, update entries, sync versions, configure distribution, and maintain marketplace.json manifests. Use when working with marketplace catalogs, plugin entries, team distribution settings, or fixing marketplace inconsistencies.
argument-hint: "[audit | register | remove | sync | configure]"
allowed-tools: Read, Write, Edit, Glob, Grep, AskUserQuestion, Bash(test *), Bash(ls *)
---
```

The allowed-tools list includes: Read (read plugin.json, marketplace.json), Write (create/overwrite files), Edit (targeted manifest edits), Glob (find plugin directories), Grep (search for patterns), AskUserQuestion (interactive operations), and two specific Bash patterns for file existence checks and directory listing. No Task, no Team tools, no blanket Bash.

**linear-sync/SKILL.md** -- Critical functional bug: cannot delegate to linear-cli without the Skill tool.

Edit the YAML frontmatter. Replace:
```yaml
allowed-tools: Read, Write, Edit, Bash(shasum *), Glob, Grep, AskUserQuestion
```
with:
```yaml
allowed-tools: Read, Write, Edit, Bash(shasum *), Glob, Grep, AskUserQuestion, Skill
```

Only the addition of `Skill` at the end. All other fields remain unchanged.

**github-issue-manager/SKILL.md** -- Model downgrade and missing argument-hint.

Edit the YAML frontmatter. Make two changes:

1. Change `model: sonnet` to `model: haiku`
2. Add `argument-hint: "[create | edit | triage | bulk-create | close]"` as a new line after the `model` line.

The resulting frontmatter should be:
```yaml
---
name: github-issue-manager
description: Create and maintain GitHub issues following best practices. Use when creating new issues, editing issue titles/bodies, triaging issues, managing issue metadata (labels, types, assignees), or converting task lists/backlogs into structured GitHub issues. Ensures consistent formatting, clear descriptions, proper categorization, and supports hierarchical issue structures (epics with child issues).
model: haiku
argument-hint: "[create | edit | triage | bulk-create | close]"
allowed-tools: Read, Grep, Glob, Bash(gh repo view *), Bash(gh issue create *), Bash(gh issue edit *), Bash(gh issue view *), Bash(gh issue list *), Bash(gh issue close *), Bash(gh label create *), Bash(gh label list *)
---
```

Note: The existing Bash patterns (7 specific `gh` commands) are already gold standard -- do NOT modify them.
  </action>
  <verify>
Read all three SKILL.md files and confirm:
- marketplace-manager: has `allowed-tools` line with Read, Write, Edit, Glob, Grep, AskUserQuestion, Bash(test *), Bash(ls *); has `argument-hint: "[audit | register | remove | sync | configure]"`
- linear-sync: `allowed-tools` line contains `Skill` at the end; `Bash(shasum *)` is preserved
- github-issue-manager: `model: haiku` (not sonnet); has `argument-hint: "[create | edit | triage | bulk-create | close]"`; all 7 `Bash(gh ...)` patterns preserved unchanged
  </verify>
  <done>marketplace-manager has allowed-tools (no longer unrestricted) + argument-hint. linear-sync has Skill tool (functional bug fixed). github-issue-manager has haiku model + argument-hint.</done>
</task>

<task type="auto">
  <name>Task 2: Update phase-researcher agent with safety limits and memory</name>
  <files>
    plugins/claude-super-team/agents/phase-researcher.md
  </files>
  <action>
**phase-researcher.md** -- Add maxTurns safety limit and memory for cross-session learning.

Edit the YAML frontmatter. The current frontmatter is:
```yaml
---
name: phase-researcher
description: Research ecosystem, libraries, architecture patterns, and pitfalls for a project phase. Produces RESEARCH.md consumed by the planner. Use when researching how to implement a phase before planning.
tools: Read, Write, Bash, Glob, Grep, WebSearch, WebFetch
model: opus
skills:
  - firecrawl
---
```

Replace it with:
```yaml
---
name: phase-researcher
description: Research ecosystem, libraries, architecture patterns, and pitfalls for a project phase. Produces RESEARCH.md consumed by the planner. Use when researching how to implement a phase before planning.
tools: Read, Write, Bash, Glob, Grep, WebSearch, WebFetch
model: opus
maxTurns: 40
memory: project
skills:
  - firecrawl
---
```

Changes:
1. Add `maxTurns: 40` -- safety limit to prevent runaway research spirals. 40 turns is generous enough for deep research (firecrawl searches + scrapes + verification) while preventing infinite loops.
2. Add `memory: project` -- enables cross-session learning of research patterns, reliable sources, and library preferences.

Note on Bash patterns: The audit identified that agent `tools` field Bash pattern support (e.g., `Bash(test *)`) is uncertain. Leave the blanket `Bash` in `tools` for now. The investigation of whether agent tools support Bash patterns is tracked separately -- if patterns are supported, a follow-up change can restrict Bash here.
  </action>
  <verify>
Read phase-researcher.md and confirm:
- `maxTurns: 40` is present in frontmatter
- `memory: project` is present in frontmatter
- `tools` line still contains `Bash` (unchanged pending investigation)
- `model: opus` is preserved
- `skills: [firecrawl]` is preserved (the `- firecrawl` format)
- Agent body (everything after the closing `---`) is completely unchanged
  </verify>
  <done>phase-researcher has maxTurns: 40 safety limit and memory: project for cross-session learning. Blanket Bash preserved pending investigation of agent tools Bash pattern support.</done>
</task>

</tasks>

<verification>
For all 4 files modified by this plan:
1. marketplace-manager has allowed-tools (verify the field exists and is non-empty) + argument-hint
2. linear-sync allowed-tools includes `Skill` (grep for it)
3. github-issue-manager has `model: haiku` and `argument-hint`
4. phase-researcher has `maxTurns: 40` and `memory: project`
5. No skill/agent bodies were altered (only frontmatter changes)
6. All existing Bash patterns in linear-sync and github-issue-manager are preserved exactly
</verification>

<success_criteria>
The two most critical audit gaps are closed: marketplace-manager has restricted tool access, linear-sync can delegate to linear-cli. github-issue-manager uses appropriate model. phase-researcher has safety limits and cross-session memory.
</success_criteria>

<output>
After completion, create `.planning/phases/03-apply-audit-recommendations/03-03-SUMMARY.md`
</output>
