# Context for Phase 1.5: Add Research Detection to Phase-Feedback Skill

## Phase Boundary (from ROADMAP.md)

**Goal:** Make phase-feedback detect when feedback requires research (e.g., missing package docs, unfamiliar APIs) and spawn a research agent inline before planning

**Success Criteria:**
1. Phase-feedback skill includes an LLM analysis step between feedback collection and planner spawning that determines if research is needed
2. When research is needed, the skill spawns the phase-researcher agent inline and passes RESEARCH.md to the planner

**What's in scope for this phase:**
- Adding a research detection step to the phase-feedback SKILL.md (Standard Feedback Path, between Step 5 and Step 10)
- Spawning the phase-researcher agent inline when research is needed
- Passing research output (RESEARCH.md) to the planner agent prompt

**What's explicitly out of scope:**
- Changes to the Quick Fix Path (Step 6)
- Changes to the phase-researcher agent definition itself
- Changes to the research-phase skill
- Adding research detection to other skills (quick-plan, etc.)

---

## Implementation Decisions

### Research Detection Method

**Decision:** Use LLM analysis of the collected feedback to determine if research is needed

**Rationale:** The LLM can analyze the feedback context and determine whether the changes involve unfamiliar packages, APIs, or patterns that need documentation lookup before planning. This is more flexible than keyword matching and doesn't add friction by asking the user.

**Constraints:** The analysis should happen after feedback is confirmed (Step 4d) and before scope routing or planner spawning. It should produce a clear yes/no signal with a brief explanation of what needs researching.

### Research Routing

**Decision:** Spawn the phase-researcher agent inline within the feedback skill, then pass the resulting RESEARCH.md to the planner

**Rationale:** The user wants a self-contained flow -- feedback collection, research if needed, then planning -- without having to manually invoke /research-phase. The phase-researcher agent already has the full research methodology and Firecrawl integration.

**Constraints:** Must use the existing `phase-researcher` custom agent (subagent_type). Research output (RESEARCH.md) must be written to the feedback subphase directory and its contents embedded in the planner prompt alongside the execution context.

---

## Claude's Discretion

- Where exactly to insert the research detection step in the SKILL.md process flow (between which existing steps)
- The specific analysis prompt/criteria for determining research need
- How to present the research decision to the user (inform vs. ask for confirmation)
- Whether to write RESEARCH.md to the feedback subphase directory or the parent phase directory

---

## Deferred Ideas

- Adding research detection to /quick-plan skill
- Making the research detection configurable (always/never/auto)
- Caching research results across feedback rounds on the same phase
