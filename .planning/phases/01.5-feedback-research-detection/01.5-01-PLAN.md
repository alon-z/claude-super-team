---
phase: 01.5-feedback-research-detection
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - plugins/claude-super-team/skills/phase-feedback/SKILL.md
  - plugins/claude-super-team/skills/phase-feedback/references/planner-feedback-mode.md
autonomous: true
quick_phase: true

must_haves:
  truths:
    - The research detection step uses LLM analysis of confirmed feedback (after Step 4d) to produce a yes/no signal with a brief explanation of what needs researching
    - The phase-researcher custom agent is spawned inline via Task tool using the same pattern as research-phase SKILL.md
    - RESEARCH.md is written to the feedback subphase directory and its content is embedded in the planner prompt
    - The Quick Fix Path (Step 6) is NOT modified
  artifacts:
    - plugins/claude-super-team/skills/phase-feedback/SKILL.md (modified -- new steps inserted in Standard Feedback Path)
    - plugins/claude-super-team/skills/phase-feedback/references/planner-feedback-mode.md (modified -- documents research input)
  key_links: []
---

<objective>
Add research detection to the phase-feedback skill so that when user feedback involves unfamiliar packages, APIs, or patterns, the skill automatically spawns the phase-researcher agent inline before planning. This closes the gap where feedback requiring ecosystem research would produce poor plans due to missing context.

Purpose: Feedback that references unknown libraries, APIs, or architectural patterns currently goes straight to the planner without research, leading to plans based on guesswork. This phase adds an LLM analysis gate that detects research needs and spawns the researcher when necessary.
Output: Modified phase-feedback SKILL.md with new research detection and spawning steps in the Standard Feedback Path, and updated planner-feedback-mode.md documenting the new research input.
</objective>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add research detection and researcher spawning steps to phase-feedback SKILL.md</name>
  <files>plugins/claude-super-team/skills/phase-feedback/SKILL.md</files>
  <action>
Insert two new steps into the Standard Feedback Path of SKILL.md, between the current Step 9 (Annotate ROADMAP.md) and Step 10 (Spawn Planner Agent). Renumber the existing Step 10 and Step 11 to Step 12 and Step 13.

**New Step 10: Detect Research Need.** After the subphase directory is created and ROADMAP.md is annotated, analyze the confirmed feedback ($FEEDBACK) together with the execution context ($EXECUTION_CONTEXT) to determine if research is needed. The analysis should consider: (a) Does the feedback reference packages, libraries, or APIs not present in the parent phase's stack? (b) Does it require integration with external services or protocols the project hasn't used before? (c) Does it involve architectural patterns or techniques not evident in existing code? Produce a $RESEARCH_NEEDED (yes/no) variable and a $RESEARCH_TOPICS brief description of what needs researching. Inform the user of the decision (e.g., "Research needed: feedback references unfamiliar API X -- spawning researcher" or "No research needed -- proceeding to planning"). Do NOT ask the user for confirmation -- this is an autonomous LLM decision to keep the flow frictionless.

**New Step 11: Spawn Researcher (conditional).** Only runs if $RESEARCH_NEEDED is yes. Spawn the phase-researcher custom agent via Task tool using the same pattern as /research-phase (subagent_type: "phase-researcher"). Pass: feedback subphase phase number and name, the user's feedback as the "phase goal" (since this is a feedback subphase, the feedback IS the goal), project context (PROJECT.md, ROADMAP.md, STATE.md), codebase docs (STACK.md, ARCHITECTURE.md if they exist), and $RESEARCH_TOPICS as the research focus. Write RESEARCH.md to ${PHASE_DIR}/${FEEDBACK_PHASE_PADDED}-RESEARCH.md. After the researcher returns, read and store the RESEARCH.md content as $RESEARCH_CONTENT. If the researcher returns RESEARCH BLOCKED, inform the user and proceed to planning without research (do not block the feedback flow).

**Modify the existing Step 10 (now Step 12: Spawn Planner Agent).** In the planner Task prompt, add a conditional research section after the execution context block. If $RESEARCH_CONTENT is non-empty, include it as:

```
Research findings (from inline research):
${RESEARCH_CONTENT}
```

This goes inside the planner prompt between the execution context and the project context sections.

Also update the "Reads" line in the Objective section to mention RESEARCH.md as an optional artifact. Update the "Creates" line to mention RESEARCH.md is optionally created. Update the Flow line to: "Validate -> Identify parent phase -> Load execution context -> Collect feedback -> Scope check -> Route (quick fix OR standard) -> [Research if needed] -> Done". Update the Standard Feedback Path success criteria to include research detection items: "Research need analyzed after feedback confirmed" and "Researcher spawned inline when research needed, RESEARCH.md passed to planner".
  </action>
  <verify>Read the modified SKILL.md and confirm: (1) Steps 10-11 exist with research detection and spawning logic, (2) Step 12 (formerly 10) planner prompt includes conditional research section, (3) Quick Fix Path (Step 6) is unchanged, (4) Step numbering is sequential with no gaps, (5) Flow description in Objective updated.</verify>
  <done>Phase-feedback SKILL.md contains an LLM analysis step that determines research need after feedback confirmation, conditionally spawns phase-researcher agent inline, and passes RESEARCH.md content to the planner prompt. The Quick Fix Path is untouched.</done>
</task>

<task type="auto">
  <name>Task 2: Update planner-feedback-mode.md to document research input</name>
  <files>plugins/claude-super-team/skills/phase-feedback/references/planner-feedback-mode.md</files>
  <action>
Update the planner-feedback-mode.md reference to document that the planner may now receive research findings alongside its existing inputs. Make three changes:

1. In the "Understanding Parent Context" section, add a fourth bullet after "User feedback": "- **RESEARCH.md content** (optional) -- if the feedback involved unfamiliar packages, APIs, or patterns, inline research was performed before planning. Use these findings to inform implementation approach, library choices, and API integration details. When present, research findings take precedence over assumptions."

2. In the "Feedback Mode vs Quick Mode vs Standard Mode" table, update the "Parent context" row for Feedback Mode from "SUMMARY.md + VERIFICATION.md loaded" to "SUMMARY.md + VERIFICATION.md + optional RESEARCH.md loaded".

3. In the "Core Principles" section, add a new principle after "Execution summaries are ground truth": "**Research informs, feedback decides.** When research findings are provided, use them to make better implementation decisions -- but the user's feedback remains the requirement. Research may reveal better approaches; incorporate them only when they serve the feedback goal."
  </action>
  <verify>Read the modified planner-feedback-mode.md and confirm: (1) Understanding Parent Context lists RESEARCH.md as optional input, (2) comparison table reflects optional RESEARCH.md, (3) new principle about research vs feedback is present.</verify>
  <done>Planner-feedback-mode.md documents research as an optional input, explains how planners should use it, and the comparison table reflects the updated context available in feedback mode.</done>
</task>

</tasks>

<verification>
1. Read the full SKILL.md and trace the Standard Feedback Path flow: Steps 7-8-9 (subphase setup) -> Step 10 (research detection) -> Step 11 (conditional researcher spawn) -> Step 12 (planner spawn with optional research) -> Step 13 (done). Confirm no gaps in numbering.
2. Confirm the Quick Fix Path (Step 6) is completely unchanged.
3. Confirm the planner prompt in Step 12 conditionally includes research content.
4. Confirm planner-feedback-mode.md references RESEARCH.md as optional input.
5. Confirm the phase-researcher agent is spawned with subagent_type: "phase-researcher" matching the pattern in research-phase SKILL.md.
</verification>

<success_criteria>
1. Phase-feedback skill includes an LLM analysis step between feedback collection and planner spawning that determines if research is needed (yes/no signal with explanation of what needs researching)
2. When research is needed, the skill spawns the phase-researcher agent inline and passes RESEARCH.md to the planner
3. The planner reference documents research as an optional input and explains how to use it
4. The Quick Fix Path is untouched
5. The flow is frictionless -- no user confirmation needed for the research decision
</success_criteria>

<output>
After completion, create `.planning/phases/01.5-feedback-research-detection/01.5-01-SUMMARY.md`
</output>
