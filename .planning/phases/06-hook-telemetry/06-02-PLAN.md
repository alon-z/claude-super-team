---
phase: 06-hook-telemetry
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - plugins/claude-super-team/skills/execute-phase/SKILL.md
  - plugins/claude-super-team/skills/plan-phase/SKILL.md
  - plugins/claude-super-team/skills/research-phase/SKILL.md
  - plugins/claude-super-team/skills/brainstorm/SKILL.md
autonomous: true

must_haves:
  truths:
    - "All 4 orchestrator skills declare telemetry hooks in YAML frontmatter"
    - "SessionStart hooks call telemetry.sh with skill_start and the correct skill name"
    - "Stop hooks call telemetry.sh with skill_end and the correct skill name"
    - "SubagentStart/SubagentStop hooks capture agent lifecycle events asynchronously"
    - "PostToolUse/PostToolUseFailure hooks capture tool usage asynchronously"
    - "Existing hooks in execute-phase (PreCompact, SessionStart compact matcher) are preserved unchanged"
  artifacts:
    - path: "plugins/claude-super-team/skills/execute-phase/SKILL.md"
      provides: "Telemetry hooks added alongside existing compaction hooks"
    - path: "plugins/claude-super-team/skills/plan-phase/SKILL.md"
      provides: "Full set of telemetry hooks in frontmatter"
    - path: "plugins/claude-super-team/skills/research-phase/SKILL.md"
      provides: "Full set of telemetry hooks in frontmatter"
    - path: "plugins/claude-super-team/skills/brainstorm/SKILL.md"
      provides: "Full set of telemetry hooks in frontmatter"
  key_links:
    - from: "plugins/claude-super-team/skills/*/SKILL.md"
      to: "plugins/claude-super-team/scripts/telemetry.sh"
      via: "Hook commands reference ${CLAUDE_PLUGIN_ROOT}/scripts/telemetry.sh"
---

<objective>
Add telemetry hook declarations to all 4 orchestrator skill YAML frontmatter files so they call `telemetry.sh` at skill start/end and key lifecycle points.

Purpose: These hook declarations wire the orchestrator skills to the telemetry capture script, enabling passive event logging for timing, agent spawns, tool usage, and outcomes -- all at zero token cost.

Output: Updated YAML frontmatter in execute-phase, plan-phase, research-phase, and brainstorm SKILL.md files
</objective>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-hook-telemetry/06-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add telemetry hooks to execute-phase SKILL.md</name>
  <files>plugins/claude-super-team/skills/execute-phase/SKILL.md</files>
  <action>
Modify the YAML frontmatter of `plugins/claude-super-team/skills/execute-phase/SKILL.md` to add telemetry hooks. This skill ALREADY has hooks (PreCompact and SessionStart with "compact" matcher). All existing hooks MUST be preserved exactly as they are.

The current frontmatter hooks section is:
```yaml
hooks:
  PreCompact:
    - matcher: "auto"
      hooks:
        - type: command
          command: 'echo "EXECUTION STATE TO PRESERVE:"; find .planning/phases -name "EXEC-PROGRESS.md" -exec cat {} \; 2>/dev/null || echo "No execution progress file found"'
  SessionStart:
    - matcher: "compact"
      hooks:
        - type: command
          command: '{ echo "=== STATE ==="; cat .planning/STATE.md 2>/dev/null; echo "=== PROJECT ==="; cat .planning/PROJECT.md 2>/dev/null; echo "=== EXEC PROGRESS ==="; find .planning/phases -name "EXEC-PROGRESS.md" -exec cat {} \; 2>/dev/null; echo "=== PLANS ==="; PHASE_DIR=$(find .planning/phases -name "EXEC-PROGRESS.md" -exec dirname {} \; 2>/dev/null | head -1); [ -n "$PHASE_DIR" ] && cat "$PHASE_DIR"/*-PLAN.md 2>/dev/null; }'
```

Add these changes to the hooks section:

1. **Add a new SessionStart matcher group** for telemetry (after the existing "compact" matcher group):
```yaml
    - matcher: ""
      hooks:
        - type: command
          command: '${CLAUDE_PLUGIN_ROOT}/scripts/telemetry.sh skill_start execute-phase'
          once: true
```
The empty matcher `""` fires on all session start types. `once: true` means it runs only once per session.

2. **Add Stop hook** (new event type):
```yaml
  Stop:
    - hooks:
        - type: command
          command: '${CLAUDE_PLUGIN_ROOT}/scripts/telemetry.sh skill_end execute-phase'
```

3. **Add SubagentStart hook** (new event type):
```yaml
  SubagentStart:
    - hooks:
        - type: command
          command: '${CLAUDE_PLUGIN_ROOT}/scripts/telemetry.sh agent_spawn execute-phase'
          async: true
```

4. **Add SubagentStop hook** (new event type):
```yaml
  SubagentStop:
    - hooks:
        - type: command
          command: '${CLAUDE_PLUGIN_ROOT}/scripts/telemetry.sh agent_complete execute-phase'
          async: true
```

5. **Add PostToolUse hook** (new event type):
```yaml
  PostToolUse:
    - hooks:
        - type: command
          command: '${CLAUDE_PLUGIN_ROOT}/scripts/telemetry.sh tool_use execute-phase'
          async: true
```

6. **Add PostToolUseFailure hook** (new event type):
```yaml
  PostToolUseFailure:
    - hooks:
        - type: command
          command: '${CLAUDE_PLUGIN_ROOT}/scripts/telemetry.sh tool_failure execute-phase'
          async: true
```

**Critical constraints:**
- Do NOT modify the existing PreCompact or SessionStart "compact" matcher hooks
- Do NOT modify any content below the `---` closing frontmatter delimiter
- The new SessionStart telemetry matcher must be a SEPARATE list item under the existing SessionStart key (not replacing the compact matcher)
- Use `async: true` for SubagentStart, SubagentStop, PostToolUse, PostToolUseFailure
- Use `once: true` only on SessionStart telemetry hook
- Stop hook does NOT use async (fires once at session end)
  </action>
  <verify>
1. Read the file and confirm all 6 new hook entries are present (skill_start, skill_end, agent_spawn, agent_complete, tool_use, tool_failure)
2. Confirm the existing PreCompact hook with "EXECUTION STATE TO PRESERVE" text is unchanged
3. Confirm the existing SessionStart "compact" matcher hook is unchanged
4. Confirm the SessionStart section has TWO list items: the "compact" matcher and the "" (empty) matcher for telemetry
5. Confirm `async: true` appears on SubagentStart, SubagentStop, PostToolUse, PostToolUseFailure hooks
6. Confirm `once: true` appears on the SessionStart telemetry hook only
7. Confirm YAML frontmatter is valid (opens and closes with `---`)
  </verify>
  <done>execute-phase SKILL.md has all 6 telemetry hooks added, existing PreCompact and SessionStart compact hooks are preserved unchanged, async/once flags are correct</done>
</task>

<task type="auto">
  <name>Task 2: Add telemetry hooks to plan-phase, research-phase, and brainstorm SKILL.md files</name>
  <files>
    plugins/claude-super-team/skills/plan-phase/SKILL.md
    plugins/claude-super-team/skills/research-phase/SKILL.md
    plugins/claude-super-team/skills/brainstorm/SKILL.md
  </files>
  <action>
Add telemetry hook declarations to the YAML frontmatter of 3 skill files. These skills currently have NO hooks section, so a new `hooks:` key must be added to each file's frontmatter.

For each of the 3 files, add the following `hooks:` block AFTER the last existing frontmatter key (which is `allowed-tools:` for plan-phase and research-phase, and `allowed-tools:` for brainstorm) and BEFORE the closing `---`:

**For plan-phase** (`plugins/claude-super-team/skills/plan-phase/SKILL.md`):
Replace `{SKILL_NAME}` with `plan-phase` in all hook commands below.

**For research-phase** (`plugins/claude-super-team/skills/research-phase/SKILL.md`):
Replace `{SKILL_NAME}` with `research-phase` in all hook commands below.

**For brainstorm** (`plugins/claude-super-team/skills/brainstorm/SKILL.md`):
Replace `{SKILL_NAME}` with `brainstorm` in all hook commands below.

The hooks block to add to each (with `{SKILL_NAME}` replaced per skill):

```yaml
hooks:
  SessionStart:
    - matcher: ""
      hooks:
        - type: command
          command: '${CLAUDE_PLUGIN_ROOT}/scripts/telemetry.sh skill_start {SKILL_NAME}'
          once: true
  Stop:
    - hooks:
        - type: command
          command: '${CLAUDE_PLUGIN_ROOT}/scripts/telemetry.sh skill_end {SKILL_NAME}'
  SubagentStart:
    - hooks:
        - type: command
          command: '${CLAUDE_PLUGIN_ROOT}/scripts/telemetry.sh agent_spawn {SKILL_NAME}'
          async: true
  SubagentStop:
    - hooks:
        - type: command
          command: '${CLAUDE_PLUGIN_ROOT}/scripts/telemetry.sh agent_complete {SKILL_NAME}'
          async: true
  PostToolUse:
    - hooks:
        - type: command
          command: '${CLAUDE_PLUGIN_ROOT}/scripts/telemetry.sh tool_use {SKILL_NAME}'
          async: true
  PostToolUseFailure:
    - hooks:
        - type: command
          command: '${CLAUDE_PLUGIN_ROOT}/scripts/telemetry.sh tool_failure {SKILL_NAME}'
          async: true
```

**Critical constraints:**
- Preserve ALL existing frontmatter fields (name, description, argument-hint, allowed-tools, model if present)
- Do NOT modify any content below the `---` closing frontmatter delimiter
- The `hooks:` key must be inside the YAML frontmatter (between the opening and closing `---`)
- Use the exact skill name in each command: `plan-phase`, `research-phase`, `brainstorm`
- Use `async: true` for SubagentStart, SubagentStop, PostToolUse, PostToolUseFailure
- Use `once: true` only on SessionStart hook
- Stop hook does NOT use async
  </action>
  <verify>
For each of the 3 files (plan-phase, research-phase, brainstorm):
1. Read the file and confirm the `hooks:` section is present in frontmatter
2. Confirm all 6 hook event types are declared: SessionStart, Stop, SubagentStart, SubagentStop, PostToolUse, PostToolUseFailure
3. Confirm each hook command references the correct skill name (plan-phase, research-phase, or brainstorm)
4. Confirm `async: true` on SubagentStart, SubagentStop, PostToolUse, PostToolUseFailure
5. Confirm `once: true` on SessionStart only
6. Confirm existing frontmatter fields (name, description, argument-hint, allowed-tools) are unchanged
7. Confirm YAML frontmatter opens and closes with `---`
8. Confirm skill body content (below closing `---`) is unchanged
  </verify>
  <done>All 3 skills (plan-phase, research-phase, brainstorm) have complete telemetry hook declarations in their YAML frontmatter with correct skill names, async flags, and preserved existing fields</done>
</task>

</tasks>

<verification>
1. For all 4 SKILL.md files, search for `telemetry.sh` to confirm hook commands are present:
   - `grep -c 'telemetry.sh' plugins/claude-super-team/skills/execute-phase/SKILL.md` -- should be 6
   - `grep -c 'telemetry.sh' plugins/claude-super-team/skills/plan-phase/SKILL.md` -- should be 6
   - `grep -c 'telemetry.sh' plugins/claude-super-team/skills/research-phase/SKILL.md` -- should be 6
   - `grep -c 'telemetry.sh' plugins/claude-super-team/skills/brainstorm/SKILL.md` -- should be 6
2. Confirm execute-phase still has its PreCompact hook: `grep 'EXECUTION STATE TO PRESERVE' plugins/claude-super-team/skills/execute-phase/SKILL.md`
3. Confirm each skill references the correct skill name in its hook commands:
   - `grep 'skill_start execute-phase' plugins/claude-super-team/skills/execute-phase/SKILL.md`
   - `grep 'skill_start plan-phase' plugins/claude-super-team/skills/plan-phase/SKILL.md`
   - `grep 'skill_start research-phase' plugins/claude-super-team/skills/research-phase/SKILL.md`
   - `grep 'skill_start brainstorm' plugins/claude-super-team/skills/brainstorm/SKILL.md`
4. Confirm no content below frontmatter `---` delimiters was changed in any file
</verification>

<success_criteria>
- All 4 orchestrator skills declare SessionStart, Stop, SubagentStart, SubagentStop, PostToolUse, PostToolUseFailure hooks
- Each hook command calls `${CLAUDE_PLUGIN_ROOT}/scripts/telemetry.sh` with the correct event type and skill name
- SessionStart hooks use `once: true`, SubagentStart/SubagentStop/PostToolUse/PostToolUseFailure use `async: true`
- Execute-phase preserves existing PreCompact and SessionStart "compact" matcher hooks unchanged
- No skill body content (below frontmatter) is modified
- Total: 24 hook declarations across 4 files (6 per file)
</success_criteria>

<output>
After completion, create `.planning/phases/06-hook-telemetry/06-02-SUMMARY.md`
</output>
